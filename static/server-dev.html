<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta http-equiv="Cache-control" content="no-cache">
    <title>InstantPhoto - Server</title>
    <link rel="icon" href="./favicon">
    <script src="/socket.io/socket.io.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.js"></script>
	<script src="/compressor.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
    <!-- Bundle: Easiest to use, supports all browsers -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@2.5.0/dist/pptxgen.bundle.js"></script>
	<!-- Qrcode-generator -->
	<script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.js"></script>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
	<!-- Google Fonts -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
	<!-- Bootstrap dependencies -->
	<link rel="stylesheet" href="./bootstrap.css">
	<script src="./bootstrap.js"></script>
	<!-- Custom Style -->
	<style>
 @keyframes rainbow { 
    0%{background-position:0% 50%}
    50%{background-position:100% 25%}
    100%{background-position:0% 50%}
	}

	body {
		background: #2BC0E4;  /* fallback for old browsers */
		background: -webkit-linear-gradient(to right, #2BC0E4, #EAECC6);  /* Chrome 10-25, Safari 5.1-6 */
		background: linear-gradient(to right, #2BC0E4, #EAECC6); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
		margin:0;
	}
	
	header h1 {
		font-family: 'Roboto', sans-serif;
		background-image: repeating-linear-gradient(45deg, violet, indigo, blue, green, yellow, orange, red, violet);
		text-align: left;
		background-size: 800% 800%;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		font-size: 35px;
		animation: rainbow 20s infinite;
		position: absolute;
		padding-left: 20px;
	}
	
	#topbar {
		width: 99%;
		overflow: hidden;
		padding: 10px 5px;
		background-color: rgba(69, 179, 169,0.5);
		display:flex;
		flex-direction: row-reverse;
		justify-content: flex-start;
		align-content: flex-start;
		flex-wrap:wrap;
		}

 #bottombar {
	 bottom: 0;
	 position: absolute;
	 width: 99%;
	 overflow: hidden;
	 padding: 7px 8px;
	 background-color: rgba(169, 179, 69, 0.3);
	 display:flex;
	 flex-direction: row;
	 justify-content: flex-start;
	 align-content: flex-start;
	 flex-wrap:wrap;
 }
	
	.styledButton {
		min-width: 110px;
		min-height: 30px;
		margin: 0 1px;
		position: relative;
		border: 2px solid white;
		justify-content: center;
		align-items: center;
		background: transparent;
		cursor: pointer;
		transition: .3s;
		color: white;
	}
	.styledButton:hover {
		box-shadow: 0px 0px 15px 5px #fff;
	}

	.popup-content{
		margin:0 auto;
	}
	
	.preview {
		position:relative; 
		width: 280px; 
		height: 70vh;
		float: right;
		overflow: auto;
	}
		
	.latency {
		bottom: 0;
		right: 10px;
		position: absolute;
	}
</style>
  </head>
  <body>
	<header>
		<h1>InstantPhoto</h1>
	</header>
	<div class="container" id="init">
		<h3>Select your role:</h3>
		<button type="button" onclick="initCS()" id="csMode">CSO</button>
		<button type="button" onclick="initTech()" id="techMode">Tech</button>
	</div>
  
    <!-- Container -->
	<div class="container-fluid" id="main">
		<div class="btn-toolbar topbar cs" role="toolbar" aria-label="Normal Usage Topbar" id="topbar">
			<button type="button" class="btn btn-light" data-toggle="modal" data-target="#popup">Room Details</button>
			<button type="button" class="btn btn-light mr-1" id="saveimage" onclick="saveimage()">Save Image : <span id="wannasavemou">No</span></button>
			<button type="button" class="btn btn-light mr-1" id="togglepptx" onclick="togglepptx()">Create PPTX : <span id="pptxgenjsstatus">Off</span></button>
			<button type="button" class="btn btn-light mr-1" id="savepptx" onclick="savepptx()" disabled>Save PPTX</button>
			<form style="float: right;position: relative" action="#" onsubmit="return false;">
			<input type="file" id="e-warranty" style="display:none !important;"/>
			<input type="text" name="GSPN" id="GSPNint" placeholder="S/O number:" disabled="disabled"/>	
			</form>
			<span id="ewanstat" style="position: relative;color: green;display:none">&#10004; E-Warranty Attached &#10004; </span>
		</div>
		<div class="head" id="top"> 
			<h5 id="head">Waiting input on client side...</h5>
		</div>
		<!-- Image output -->
		<img style="max-width:640px; max-height:480px;" src="" id="download"/>
	
		<!-- Preview sidebar -->
		<div class="preview" id="rightbar">
		</div>
	
		<p class="latency" id="socketlatency">Getting Latency...</p>
	</div>
	
	<div class="modal fade" id="popup" tabindex="-1" role="dialog" aria-labelledby="roomqr-popup" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="popup-title" onclick="devTool()">Room details</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="popup-content modal-body">
					<p>Current room: <span id="roomindicator"></span></p>
					<p></p>
					<div id="roomqr"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" id="changeroom" onclick="refreshroom()">Change Room</button>
				</div>
			</div>
		</div>
	</div>

	<div class="warnings" style="color: red">
		<span id="pptxnotenabled" style="display:none">Warning : PPTX not enabled!</span>
		<br />
		<span id="nosaveimage" style="display:none">Notice : Image not downloaded!</span>
	</div>
</body>

<footer>
	<div class="btn-toolbar bottombar" role="toolbar" aria-label="Developer Bottombar" id="bottombar" style="display:none">
		<button type="button" class="btn btn-light mr-1" id="moreopt" onclick="moreopt()" style="display:none;">Expand</button>
		<div class="btn-container" id="btn-container" >
			<button type="button" class="btn btn-dark" id="clrtmb" onclick="rmtmb()">Clear Thumbnail</button>
			<button type="button" class="btn btn-dark" id="pinglog" onclick="_log('ping')"><span id="ping">Show</span> Ping Log</button>
			<button type="button" class="btn btn-dark" id="imgdatalog" onclick="_log('imgdata')"><span id="imgdata">Show</span> ImgData Log</button>
		</div>
	</div>
</footer>
<!-- Client Code -->
    <script type="text/javascript">	  
	  //Debug section
	  let isDebug = ( !!window.location.href.match(/dev/g) );
	  
	  //Define all document elements
	  const _svppt = document.getElementById("savepptx");
	  const _gpint = document.getElementById("GSPNint");
	  const _pptstat = document.getElementById("pptxgenjsstatus");
	  //const _togppt = document.getElementById("togglepptx"); //no longer in use
	  const output = document.getElementById("download");
	  const _pptxne = document.getElementById("pptxnotenabled");
	  const _fileInput = document.getElementById("e-warranty");
	  const _imgdown = document.getElementById("wannasavemou");
	  const _nsi = document.getElementById("nosaveimage");
	  const _ewanatt = document.getElementById("ewanstat");
	  const _btncoint = document.getElementById("btn-container");
	  const _moreopt = document.getElementById("moreopt");
	  const _latency = document.getElementById("socketlatency");
	  const _tmbdiv = document.getElementById("rightbar");
	  const _roomqr = document.getElementById("roomqr");
	  const _roomindicator = document.getElementById("roomindicator");
	  const _mainContainer = document.getElementById("main");
	  const _initContainer = document.getElementById("init");
	  const _header = document.getElementById("head");
	  const _ping = document.getElementById("ping");
	  const _imgdata = document.getElementById("imgdata");
	  const _bottombar = document.getElementById("bottombar");
	  const _rightbar = document.getElementById('rightbar');
	
	  //Initialize elements
	  let pptxenabled = false;
	  let saveimg = false;
	  let optenb = false;
	  let photocount = 0;
	  let latencycount = 0;
	  let room;
	  let logping = false;
	  let logimgdata = false;

	  //Enable PPTXGenJS...or not?
	  function togglepptx() {
		if (pptxenabled) {
	      _pptstat.innerHTML = "Off";
	      pptxenabled = false;
	      _svppt.disabled = true;
		  _gpint.value = "";
	      _gpint.disabled = true;
		  _fileInput.value = "";
		  _fileInput.disabled = true;
		  _ewanatt.style.display = "none";
		  photocount = 0;
		  rmtmb();
		  socket.emit("status",`PptxGenJS not enabled!`,room);
		  _consoleLog(`PptxGenJS disabled.`);
		  _header.innerHTML = "PptxGenJS disabled.";
	    } else {
		  window.pptx = new PptxGenJS();
	      pptxenabled = true;
	      _svppt.disabled = false;
	      _gpint.disabled = false;
		  _fileInput.disabled = false;
	      _pptxne.style.display = "none";
	      _pptstat.innerHTML = "On";
		  socket.emit("status",`Now adding photo ${photocount+1}`,room);
		  _consoleLog(`PptxGenJS enabled, waiting photo.`);
		  _header.innerHTML = "PptxGenJS enabled, waiting photo.";
		}
	  }

	  // Get WebSocket
	  const socket = io();

	  // new "transimage" socket - w/o room param 
	  socket.on("transimage", function(image) {
		  _consoleLog(`Image received, processing.`);
	      output.src = image;
	      //Download image if enabled
		  if (saveimg === true) {
	          download(image, smartFilename(), "application/octet-stream;base64");
		  } else {
		      _nsi.style.display = "block"
			  }
	      if (pptxenabled === true) {
		      addSlide(image);
	      } else {
	          _pptxne.style.display = "block";
	      }
	  });
	  
	  //External Func for random string generating
	  function genRand(len) {
        const hash = "abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ12346789";
        let randomStr = '';
        for(let i = 0; i < len; i++){
            randomStr += hash[parseInt(Math.random()*hash.length)];
        }
        return randomStr;
	  } 
	  
	  //Newer filename function to determine filename
	  function smartFilename() {
		let filename = _gpint.value;
	    if (filename) {
			return filename.trim();
		} else {
			const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
			const stringLength = 10;
			function pickRandom() {	return possible[Math.floor(Math.random() * possible.length)]; }
			let randomString = Array.apply(null, Array(stringLength)).map(pickRandom).join('');
			return randomString;
		}
	  }

	async function genQR(data) {
		const qrcode = new QRCode("roomqr");
		qrcode.makeCode(data);
	}
	
		
	  //Refresh Room
	  function refreshroom() {
	    //Theres a bug here, the condition wont meet even room exist
		if(room) {
			let oldroom = room;
			socket.emit("leave", oldroom);
			}
	  
		room = genRand(10);
		
	  // Join default channel "test"
	  // for debug only
	  /*
	  const room = "test";
	  */
		
	    _roomindicator.innerHTML = room;
		_roomqr.innerHTML = "";
		genQR(room);
		socket.emit("join", room);
		socket.emit("server","isOnline",room);
	  }

	  //Whenever adding a new slide, image data will parse into this function
	  function addSlide(image) {
		  window.slide = pptx.addNewSlide();
		  // Creating anonymous async func to check img orientation
		  // checking was done by outer func
		  orientCheck(image).then(rotated_image => {
			  if(logimgdata) {
				  _consoleLog(`Response: ${rotated_image}`);
			  }
			  triggerthumbnail(rotated_image);
			  slide.addImage({ data: rotated_image, x: 0, y: 0, w: 10, h: 5.6});
			  _header.innerHTML = `Added Image #${photocount}.`;
		  });
	  }


	  //Save PPTX as file and reset all to default
	  function savepptx() {
	    if (_gpint && _gpint.value) {
	      pptx.save(smartFilename());
	      _pptstat.innerHTML = "Off";
	      pptxenabled = false;
	      _svppt.disabled = true;
		  _gpint.value = "";
	      _gpint.disabled = true;
		  _fileInput.value = "";
		  _fileInput.disabled = true;
		  _ewanatt.style.display = "none";
		  photocount = 0;
		  socket.emit("status",`File saved. Please re-enable PPTXGenJS.`,room)
		  rmtmb();
		  _consoleLog(`PPT file saved. Status resetted.`);
	  } else {
	   alert("No GSPN Service Order number!");
	    }}

	//Toggle SaveImage On/Off
	function saveimage() {
         switch(saveimg) {
		   case true:
		     saveimg = false;
		     _imgdown.innerHTML = "No";
			 _nsi.style.display = "block";
			 _fileInput.disabled = true;
			 break;
		   case false:
             saveimg = true;
		     _imgdown.innerHTML = "Yes";
			 _nsi.style.display = "none";
			 _fileInput.disabled = false;
             break;
          }}	
	   
//generate thumbnail for current received image and show at sidebar
function triggerthumbnail(image){
	resizeImageToSpecificWidth(200, image, function(dat) {
		const tmbnail = document.createElement("img");
		tmbnail.src = dat;
		tmbnail.setAttribute('id', 'tmbtnb');
		_tmbdiv.appendChild(tmbnail);
		});
		setTimeout(function(){_tmbdiv.scrollTop = _tmbdiv.scrollHeight;},100);
		photocount++
		socket.emit("status",`Now adding photo ${photocount+1}`,room);
}

//Sub-function required for creating thumbnail
function resizeImageToSpecificWidth(max, imgur, cb) {
  let data;
  const img = new Image();
  img.onload = function() {
	  const oc = document.createElement('canvas'), octx = oc.getContext('2d');
	  if (img.width > max) {
        oc.width = img.width;
        oc.height = img.height;
        octx.drawImage(img, 0, 0);
        if( img.width > img.height) {
            oc.height = (img.height / img.width) * max;
            oc.width = max;
        } else {
            oc.width = (img.width / img.height) * max;
            oc.height = max;
        }
        octx.drawImage(oc, 0, 0, oc.width, oc.height);          
        octx.drawImage(img, 0, 0, oc.width, oc.height);
        data = oc.toDataURL();
    } else {
       data = oc.toDataURL();
    }
    cb(data);
    };
    img.src = imgur;
  }
  
// Function to rotate image through extra canvas
// Note: ES6 is required or else code will report error
// Reference: https://jsfiddle.net/tenent007963/sfta0725/1/
async function orientCheck(data) {
	return promise = new Promise(resolve => {
		_consoleLog(`Checking image orientation`);
        let img = new Image();
		img.crossOrigin="anonymous";
        img.src = data;     
        // Create a canvas object.
        let canvas = document.createElement("canvas");
        // Wait till the image is loaded.
        img.onload = function(){
			if (img.height > img.width) {
				_consoleLog(`Orientation incorrect, rotating`);
				rotateImage();
			} else {
				_consoleLog(`Orientation correct,exit now`);
				resolve(returnImg());
			}			
        }
        let rotateImage = () => {
            // Create canvas context.
            let ctx = canvas.getContext("2d");
            // Assign width and height.
            cw = img.height;
			ch = img.width;
			cx = 0;
			cy = img.height * (-1);
			
			canvas.setAttribute('width', cw);
			canvas.setAttribute('height', ch);
			ctx.rotate(90 * Math.PI / 180);
			ctx.drawImage(output, cx, cy);
			_consoleLog(`Image rotation complete.`);
			//return canvas.toDataURL("image/png");
			canvas.toBlob(function(blobData){ compressImg(blobData);});
        }
		
		let compressImg = (imgStream) => {
			const fileReader = new FileReader()
			new Compressor(imgStream, {
						quality: 0.6,
						checkOrientation: false,
						success(result) {
							// Read file
							fileReader.readAsDataURL(result);
						},
						error(err) {
						  _consoleLog(err.message);
						},
					});
			fileReader.onloadend = function (event) {
				resolve(event.target.result);
			}
		}
		
		let returnImg = () => {
			return data;
		}
    });
}

	// Select Modes #TODO
	//CS mode
	function initCS() {

	}

	//Tech mode
	function initTech() {

	}

	// Room initializing, check if all variable is correct
	function checkRoomInitialize() {
		try {
			//check isDebug environment
			if (isDebug) {
				window.document.title = "InstantPhoto - Server(Development)";
			}
			//Run through necessary func
			refreshroom();
			//Display interface
			$('#popup').modal('show');
			_initContainer.style.display = "none";
			_mainContainer.style.display = "block";
			_consoleLog(`Server ready.`);
		}
		catch (err) {
			_mainContainer.innerHTML = err.message;
			location.reload();
		}
	}



	  //Active listener for window

	//Listening to Hotkeys 
	window.addEventListener("keydown", function(event) {
		switch(event.key) { 
		case "Enter":
			_consoleLog(`Enter Key Pressed`);
			event.preventDefault();
			if (!pptxenabled) {
				_consoleLog('Nothing to do.Exit now.');
				return false; //return true to submit, false to do nothing
			} else {
				if (photocount >=2) {
					savepptx();
					_consoleLog(`Saving PPT file`);
				} else {
					_consoleLog('PptxGenJS enabled but not enough photos, assuming mispress.');
					return false; //return true to submit, false to do nothing
				}
			}
			break;
		case "x" :
			if (!pptxenabled) {
				togglepptx();
				}
			break;
		case "X":
			if (!pptxenabled) {
				togglepptx();
				}
			break;
		case ( (event.ctrlKey && event.shiftKey && event.altKey) & "z" || "Z"  ):
			if (pptxenabled) {
				togglepptx();
				alert(`File discarded!`);
			}
			break;
		case '`':
			saveimage();
			break;
		default:
			_consoleLog(`${event.key}`);
			break;
		}
	});
   
   	window.addEventListener('paste', function(e) {
		clipboardData = e.clipboardData;
		_fileInput.files = clipboardData.files;
		const file = document.querySelector('input[type=file]').files[0];
		const reader =  new FileReader();
		pastedData = clipboardData.getData('Text');
		
	    if (pptxenabled) {
			_consoleLog(`Detecting input type`);	
			if (pastedData) {
				_consoleLog(`Detected input as text`);
				setTimeout(function(){ 
					if (_gpint.value === pastedData) { 
						return false;
					} else {
						_gpint.value = pastedData;
						return false;
					}},100);
			} else if (file instanceof Blob) {
				_consoleLog(`Detected input as blob`);
				reader.readAsDataURL(file);
				reader.onloadend = function () {
					let ewanss = reader.result;
					addSlide(ewanss);
					if (saveimg === true) {
						download(ewanss, smartFilename(), "application/octet-stream;base64");
					}
				}
				_ewanatt.style.display = "block";
			} else {
				_consoleLog(`Unknown input type, aborting.`);
				reader.abort();
				} 
		} else if(saveimg) {
			if (file instanceof Blob) {
				reader.readAsDataURL(file);
				reader.onloadend = function () {
					let pastedImg = reader.result;
					download(pastedImg, smartFilename(), "application/octet-stream;base64");
				}
			} else {
			_consoleLog(`Unknown input type, aborting.`);
				reader.abort();
			}
		} else {
			alert("PPTXGenJS not enabled!");
		}
	});


	  //Below are all functions that are used in dev mode

	  //Enable Dev toolbar (bottombar)
	  function devTool() {
		  if (typeof xyz === 'undefined') {
			  xyz = 1;
		  }
		  xyz++;
		  if(xyz===11){
			  let passcode = prompt("Please enter passcode for the development section:", "WritePasswordHere");
			  let passphrase = prompt("Please enter passphrase for verification:", "WritePassphraseHere");
			  if (passcode === null || passcode === "") {
				  _consoleLog("User cancelled the prompt.");
				  return false;
			  } else if(passphrase === null || passphrase === "") {
				  _consoleLog("No passphrase.");
				  return false;
			  } else {
			  	const enckey = 'U2FsdGVkX18iazBzCd0Chor8UE+OucOwE3Tlc3yL2wg='; //Pre-enc key
			  	let decKey = CryptoJS.AES.decrypt(enckey, passphrase).toString; //Static dec key from pre-enc key
			  	let inputkey = CryptoJS.AES.encrypt(passcode, passphrase); //Enc key from user input
				let inputKeyDec = CryptoJS.AES.decrypt(inputkey, passphrase).toString; //Static dec key from user input
				// decrypted.toString(CryptoJS.enc.Utf8)
			  	if (decKey === inputKeyDec) { //Verify both static dec key
					_bottombar.style.display="block";
					_consoleLog("Activated.");
					return true;
				} else if(decKey !== inputKeyDec) {
					_consoleLog(`decKey=${decKey},inputKeyDec=${inputKeyDec}, incorrect key.`);
					return false;
				} else {
			  		_consoleLog('Unknown Error.')
				}
			  }
		  }
	  }

	  //rightbar (thumbnail) cleaning
	  function rmtmb() {
		  _rightbar.innerHTML = '';
		  _consoleLog(`Rightbar (Preview bar) cleaned.`);
	  }

	  //toggle more buttons
	  function moreopt() {
		  switch(optenb) {
			  case true:
				  optenb = false;
				  _btncoint.style.display = "none";
				  _moreopt.textContent = "Expand";
				  break;
			  case false:
				  optenb = true;
				  _btncoint.style.display = "block";
				  _moreopt.textContent = "Collapse";
				  break;
		  }
	  }

	  //static function for enable/disable logging
	  function _log(opt) {
		  switch(opt) {
			  case 'ping':
				  if(!logping) {
					  logping = true;
					  _ping.innerHTML = "Hide";
					  _consoleLog('Ping En-log');
				  } else {
					  logping = false;
					  _ping.innerHTML = "Show";
					  _consoleLog('Ping De-log');
				  }
				  break;
			  case 'imgdata':
				  if(!logimgdata) {
					  logimgdata = true;
					  _imgdata.innerHTML = "Hide";
					  _consoleLog('ImgData En-log');
				  } else {
					  logimgdata = false;
					  _imgdata.innerHTML = "Show";
					  _consoleLog('ImgData De-log');
				  }
				  break;
			  default:
				  return false;
		  }
	  }


  // Below are all socket functions / connections
 
  // Upon socket disconnection
	socket.on('disconnect', function(){
      // Save current active ppt with random hash and proceed page reload
	  if (pptxenabled && photocount >= 2) {
		pptx.save(smartFilename());
		}
	  window.location.reload();
	  _consoleLog(`Socket disconnected`);
	});
	
  	// Return server image status to client upon call
	socket.on("status",(data) => {
	  _consoleLog(`Received parsed request from host`)
      switch(data) { 
	  case "check":
		  _consoleLog(`Sending status..`);
		  $('#popup').modal('hide');
		  if (pptxenabled) {
			socket.emit("status",`Now adding photo ${photocount+1}`,room);
			} else {
			socket.emit("status",`PptxGenJS not enabled!`,room);
			}
		break;
	  case "save":
		if (pptxenabled) {
			savepptx();
		}
		break;
      default:
		_consoleLog(`Request dropped!`);
		break;
	}
	});
	
	// Latency checking
	socket.on('pong', function(ping) {
		_latency.textContent = ping + 'ms';
		if(logping) {
			_consoleLog(`Received Pong: ${ping}`);
		}
		//Prompt if latency over acceptable threshold
		if (ping >= 550) {
			latencycount++;
			if (latencycount >= 4) {
				_latency.style.color = "red";
			}
			if (latencycount >= 7) {
				alert('High latency detected, some functions might not working properly.');
			}
		}
		if (ping < 500) {
			latencycount = 0;
			_latency.style.color = "black";
		}
	});
	
	// noinspection JSValidateTypes
	  window.onload = checkRoomInitialize();
	
	//Small cheat code to make sure heroku dyno doesn't go idling when user is connected
	  function httpGetAsync(theUrl, callback)
	  {
		  const xmlHttp = new XMLHttpRequest();
		  xmlHttp.onreadystatechange = function() {
			  if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
				  callback(xmlHttp.responseText);
		  }
		  xmlHttp.open("GET", theUrl, true); // true for asynchronous
		  xmlHttp.send(`Dont sleep fker - Morning call from server side of ${room}`);
	  }

	  //To execute every 25 mins
	  setInterval((function() {
		  function loop() {
			  socket.emit("server","keepAlive",room);
			  httpGetAsync('/keepalive',function(res){
			  	_consoleLog(`Keepalive status from host: ${res}`);
			  })
		  }
		  loop();
		  return loop;
	  }()), 1500000);


	//Default debug Code, do not modify
	function _consoleLog(stringData) {
		if(isDebug) {
			console.log(stringData);
			} 
		}
    </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js" crossorigin="anonymous"></script>
</html>
