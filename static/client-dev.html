<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.5,maximum-scale=3,user-scalable=no"/>
    <title>InstantPhoto - Client(Development)</title>
    <link rel="icon" href="./favicon">
    <script src="/socket.io/socket.io.js"></script>
	<style>
	html {
		height: 100%;
		margin: 0;
		}
	
	body {
		background: linear-gradient(to bottom, #66ccff 0%, #6699ff 100%),no-repeat;
		height:100%;
		width:50%;
		text-align:center;
		margin:0;
	}
	.center{
		padding-top: 40%;
		}
		
	button {
		position: relative; 
		width: 140px; 
		height: 25px;
		}
		
	</style>
  </head>
  
  <body>
  <button type="button" id="refresh" onclick="window.location.reload();" style="float: left" >Refresh page</button>
  
    <!-- File input -->
	<div class="center">
	<button type="button" class="button" id="plusroom" onclick="plusroom()">Change Room +</button>
	<button type="button" class="button" id="minusroom" onclick="minusroom()" disabled>Change Room -</button>
	<br />
	<h4 style="text-align:left">Current room: <span id="roomindicator"></span></h4>
	<h4 id="status" style="text-align:left;">Now adding photo number 1</h4>
	<form id="holder" name="upload">
	<span>Take photo directly:</span>
	<input id="input1" type="file" name="fresh" accept="image/*" capture="camera" autofocus>
	<br /><br />
	<span>Upload photo from gallery:</span>
	<input id="input2" type="file" name="gallery" accept="image/*">
	</form>
	
	</div>	
	</body>
    <!-- Client Code -->
    <script type="text/javascript">
	  
      // Get WebSocket
      var socket = io();

      // Get DOM elements
      var _src1 = document.getElementById("input1");
	  var _src2 = document.getElementById("input2");
	  var _status = document.getElementById("status");
	  var _fileform = document.getElementById("holder");

      // Join a channel
      let room = "test";
	  let rm = "0";
      socket.emit("join", room);
	  document.getElementById("roomindicator").innerHTML = room;

		// Listen to Source1 and Source2 input events
		[_src1,_src2].forEach(function(sauce){ 
			sauce.addEventListener("change", function (event) {

				// Prepeare file reader
				var file = event.target.files[0];
				var fileReader = new FileReader();
		
				// Determine input type 
				if (file instanceof Blob) {
					// Read file
					fileReader.readAsDataURL(file);
				}
				fileReader.onloadend = function (event) {
				// Send an image event to the socket
				var image = event.target.result;
				// Add line for compressing image data here
		  
				socket.emit("image", image , room);
				console.log(`Sending data stream to ${room}`);
				};
			});
		});
	  
	function plusroom() {
	 rm++ ;
	 joinroom(rm);
    }	
	
	function minusroom() {
	 rm-- ;
	 joinroom(rm)
    }	

	function joinroom(rm) {
	 let oldroom = room;

	 if (rm >= 6) {
	   if (rm = 6) {	 
	     document.getElementById("plusroom").disabled = true;
		} else { 
	     rm-- ;
	     alert("Invalid Room selected.");
	   } }
	 
	 if (rm >= 1 , rm < 6 ) {
	 document.getElementById("plusroom").disabled = false;
	 document.getElementById("minusroom").disabled = false;
	 }
	 
	 if (rm <= 1) {
	  if (rm = 1 ) {
	   document.getElementById("minusroom").disabled = true;
	  } else { 
	   rm++ ;
	   alert("You had reached the end!");
	 }  }
	
	switch (rm) {
	  case 1:
       room = "room1";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break;
	  case 2: 
	   room = "room2";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break;
	  case 3:
	   room = "room3";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break;
	  case 4: 
	   room = "room4";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break;
	  case 5: 
	   room = "room5";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break;
	  case 6: 
	   room = "room6";
	   socket.emit("leave", oldroom);
	   socket.emit("join", room);
	   break; 
	  default:
	   room = "test";
		break;
		}
		
	 document.getElementById("roomindicator").innerHTML = room;
	 
    }
	
	socket.on("status",function(data){
		_status.textContent = data;
		_fileform.reset();
	});
	
	// Checking on socket connection
	socket.on('disconnect', function(){
      // solution 1: refresh page
	  window.location.reload();
	  // solution 2: reconnect socket
	  //socket.connect();
	});
    </script>
</html>
